# tcp分包
##问题
如何从数据流中将一个一个的消息区分出来。
短链接很简单，发送方主动关闭了连接，说明一个消息发送完毕，接收方read()得到0。对于长连接，可以有这几个方法：
##造成的原因
1. 开启了nagle算法,为了减少网络中小段的数量，最多只能由一个未被ack的包，其他的就拼接在一起。(这里的小段指的是小于MSS尺寸)
2. 发送的数据较大，超过了mss，那肯定会被TCP分片的
##解决办法
- 固定消息长度
- 使用特殊的字符或字符串作为定界符
- 在每条消息的前头加一个长度
- 利用消息本身的格式来分包，例如xml或json格式


#知识补充

##MTU
Maximum Transmission Unit 一种通信协议的某一层上面所能通过的最大数据包

以太网为1500,这也是为什么路由器或PC都默认1500,因为一旦数据包超过此大小，就必须由IP分片,但是IP包是不可靠的，如果IP分片了，如何保证TCP是可靠的。这就需要引入MSS了。

##MSS

Maximum Segment size tcp协议里面的一个参数，以字节数定义一个设备所能接受的分段的最大数据量，注意这里不包含IP头或TCP/UDP头

例如TCP,MSS=1500-20(IP头)-20(TCP头)

通过提前的tcp分段确保数据不会超过MTU,来保证IP不再分片
o